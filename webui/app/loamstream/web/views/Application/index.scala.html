@()(implicit request: RequestHeader)
<html>
    <head>
        <title>LoamStream WebUI</title>
        <style>
        body {
            font-family: sans-serif;
            color: yellow;
            background-color: black;
        }

        textarea, button, select, option {
            color: yellow;
            background-color: darkgreen;
            font-weight: bold;
        }
        </style>
        <script src="@{
            routes.Assets.at("javascripts/d3.min.js")
        }" type="text/javascript"></script>
        <script>
                var socket = new WebSocket("@{loamstream.web.controllers.routes.WebController.socket.webSocketURL()}");
                socket.onmessage = function (event) {
                    receiveSocketMessage(event);
                };
                socket.onopen = list;
                function serverResponseNode() {
                    return d3.select("#serverResponse");
                }
                function sendText() {
                    var text = d3.select("textarea").property("value");
                    serverResponseNode().text("");
                    socket.send(JSON.stringify({type: "text", text: text}));
                }
                function list() {
                    socket.send(JSON.stringify({type: "list"}));
                }
                function load() {
                    var name = d3.select("#selectFile").node().value;
                    socket.send(JSON.stringify({type: "load", name: name}));
                }
                function save() {
                    var name = d3.select("#selectFile").node().value;
                    var text = d3.select("textarea").property("value");
                    socket.send(JSON.stringify({type: "save", name: name, content: text}));
                }
                function receiveSocketMessage(socketMessage) {
                    var data = JSON.parse(socketMessage.data);
                    var responseText = serverResponseNode().text() + "\n[" + data.type + "] " + data.message;
                    serverResponseNode().text(responseText);
                    if (data.type == "load") {
                        d3.select("textarea").property("value", data.content);
                    } else if (data.type == "list") {
                        var options = d3.select("#loamFiles").selectAll("option").data(data.entries);
                        options.enter().append("option")
                                .attr("value", function (d) {
                                    return d;
                                }).text(function (d) {
                            return d;
                        });
                    }
                }
        </script>
    </head>
    <body>
        <h1>LoamStream WebUI</h1>
        <p>
            <button type="button" onclick="sendText()">Submit</button>
            <button type="button" onclick="load()">Load</button>
            <button type="button" onclick="save()">Save</button>
            <label for="selectFile">File:</label>
            <input list="loamFiles" id="selectFile"/>
            <datalist id="loamFiles"></datalist>
        </p>
        <pre id="serverResponse">Write into the text area and click 'submit'.</pre>
        <p><textarea title="DSL Editor" rows="42" cols="100"></textarea></p>
    </body>
</html>
